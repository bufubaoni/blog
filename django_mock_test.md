# mock test
## 引入原因
大部分业务逻辑通过`client`来进行测试，会有很多业务无法测试，包括代码覆盖率也不能很好的涵盖，ci的集成度不是很高。所以希望在自动集成之前先进行`unittest`而测试希望进行无依赖的`mock`数据。
## 库依赖
    
    - django-mock
    - faker
希望通过`mock`来模拟model，希望通过`faker`来减少数据重复。

## 具体操作过程
其余的过程不自多说，稍后说一下思路。具体单元测试不应当测试其他函数依赖，所以叫做单元测试，具体函数测试应该是其他写入其他单元中，不过应当视具体函数而写具体测试。

## 具体用法
使用`mock`来模拟对象，使用`magicmock`可以模拟变量，`patch`用来引用对象注入。使用`pach`的时候注意装饰函数的位置与注入对象的位置对应。选择`patch`注入的时候，应当注意顺序，其实也是装饰器参数的顺序，对应关系很容易搞错。

## 测试tasks
业务中肯定会遇到测试tasks的时候，此时只直接测试其逻辑即可，也就是不使用delay方法，直接调用方法即可，使用`patch`可以简单的将其中的复杂调用减少为简单的`mock`方法。

## 测试setting
在测试过程中，发现有时候测试需要不同的配置，也就是环境settings，此时和运行环境隔离开，

    - 使用不同的配置文件 
    - manage.py test --settings=mysite.settings_local
    - 如果仅仅是部分修改可以使用`override_settings`装饰器来对部分域的`settings`设置
